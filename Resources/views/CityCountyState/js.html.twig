<script src="/eval/bundles/lthrtschemavisualizer/js/jquery.min.js"></script>

{# Change state then...  #}
<script>
function wire(){

    var data = {};
    var city   = $('#lthrt_contactbundle_citycountystate_city');
    var county = $('#lthrt_contactbundle_citycountystate_county');
    var state  = $('#lthrt_contactbundle_citycountystate_state');

    console.log('wiring');
    console.log(city);
    city.off("change");
    city.on("change",function() {
        data['city'] = city?city.val():'';
        data['county'] = county?county.val():'';
        data['state'] = state?state.val():'';
        console.log('city');
        console.log(data);
        var form = $(this).closest('form');
        $.ajax({
            url : form.attr('action'),
            type: form.attr('method'),
            data : data,
            success: function(html) {
                if (county.val()) {
                } else {
                    $('#lthrt_contactbundle_citycountystate_county').replaceWith(
                        $(html).find('#lthrt_contactbundle_citycountystate_county')
                    );
                }

                if (state.val()) {
                } else {
                    $('#lthrt_contactbundle_citycountystate_state').replaceWith(
                        $(html).find('#lthrt_contactbundle_citycountystate_state')
                    );
                }
            },
            complete: function(jqXHR, status) {
                wire();
            }
        });
    });

    county.off("change");
    county.on("change",function() {
        data['city'] = city?city.val():'';
        data['county'] = county?county.val():'';
        data['state'] = state?state.val():'';
        console.log('county');
        console.log(data);
        var form = $(this).closest('form');
        $.ajax({
            url : form.attr('action'),
            type: form.attr('method'),
            data : data,
            success: function(html) {
                if (city.val()) {
                } else {
                    $('#lthrt_contactbundle_citycountystate_city').replaceWith(
                        $(html).find('#lthrt_contactbundle_citycountystate_city')
                    );
                }

                if (state.val()) {
                } else {
                    $('#lthrt_contactbundle_citycountystate_state').replaceWith(
                        $(html).find('#lthrt_contactbundle_citycountystate_state')
                    );
                }

            },
            complete: function(jqXHR, status) {
                wire();
            }
        });
    });

    state.off("change");
    state.on("change",function() {
        data['city'] = city?city.val():'';
        data['county'] = county?county.val():'';
        data['state'] = state?state.val():'';
        console.log('state');
        console.log(data);
        var form = $(this).closest('form');
        $.ajax({
            url : form.attr('action'),
            type: form.attr('method'),
            data : data,
            success: function(html) {
                if (city.val()) {
                } else {
                    $('#lthrt_contactbundle_citycountystate_city').replaceWith(
                        $(html).find('#lthrt_contactbundle_citycountystate_city')
                    );
                }

                if (county.val()) {
                } else {
                    $('#lthrt_contactbundle_citycountystate_county').replaceWith(
                        $(html).find('#lthrt_contactbundle_citycountystate_county')
                    );
                }
            },
            complete: function(jqXHR, status) {
                wire();
            }
        });
    });
}

wire();

</script>
